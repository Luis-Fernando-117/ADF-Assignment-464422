---
title: "ADF Individual Assignment Report"
author: "Luis F. Barros - 464422"
date: "Last compiled on `r Sys.Date()`"
output: 
    bookdown::html_document2:
        toc: true
        toc_float: 
            collapsed: false
        number_sections: true
        code_folding: hide
        theme: cerulean
editor_options: 
  chunk_output_type: console
---
# Introduction 

For this notebook, it is needed to load an R.Data file containing all the raw 
information from Twitter that I got from "collect_data.R" script. 
The output should be another .RData file with the preprocessed data that has the data converted
into data frames ready to analyze.

# Data aquisition and processing

# Data Analysis 

Load Libraries 
```{r, message=FALSE }
library("httr")
library("jsonlite")
library("tidyverse")
library("twitteR")
library("rtweet")
library("plyr")
library("dplyr")
library("data.table")
library("tidytext")
library("textdata")
library("udpipe")
library("ggplot2")
library("hrbrthemes")
```

Load Objects
```{r}
# Followers tweets
  load("text.tweets.obrador.followers.RData")
  load("text.tweets.pinera.followers.RData")
  load("text.tweets.lenin.followers.RData")
  load("text.tweets.bukele.followers.RData")
  
# Presidents Tweets
  load("text.tweets.obrador.RData")
  load("text.tweets.pinera.RData")
  load("text.tweets.lenin.RData")
  load("text.tweets.bukele.RData")
```

Final Data Preparation (consider moving this to data processing file)
Merge tweets texts into a single data frame
```{r}
# For followers tweets
text.tweets.obrador.followers$doc_id <- "Obrador_followers"
text.tweets.pinera.followers$doc_id  <- "Pinera_followers"
text.tweets.lenin.followers$doc_id   <- "Lenin_followers"
text.tweets.bukele.followers$doc_id  <- "Bukele_followers"

# For presidents tweets 
text.tweets.obrador$doc_id <- "President of Mexico"
text.tweets.pinera$doc_id  <- "President of Chile"
text.tweets.lenin$doc_id   <- "President of Ecuador"
text.tweets.bukele$doc_id  <- "President of El Salvador"
```

Convert all the tweets text to lowercase
```{r}
# For followers
text.tweets.obrador.followers$text <- tolower(text.tweets.obrador.followers$text)
text.tweets.pinera.followers$text  <- tolower(text.tweets.pinera.followers$text)
text.tweets.lenin.followers$text   <- tolower(text.tweets.lenin.followers$text)
text.tweets.bukele.followers$text  <- tolower(text.tweets.bukele.followers$text)

# For presidents tweets
text.tweets.obrador$text <- tolower(text.tweets.obrador$text)
text.tweets.pinera$text  <- tolower(text.tweets.pinera$text)
text.tweets.lenin$text   <- tolower(text.tweets.lenin$text)
text.tweets.bukele$text  <- tolower(text.tweets.bukele$text)
```

Calculate the length of each tweets
```{r}
# For followers tweets 
text.tweets.obrador.followers$length <- 
  sapply(strsplit(text.tweets.obrador.followers$text, " "), length)

text.tweets.pinera.followers$length <- 
  sapply(strsplit(text.tweets.pinera.followers$text, " "), length)

text.tweets.lenin.followers$length <- 
  sapply(strsplit(text.tweets.lenin.followers$text, " "), length)

text.tweets.bukele.followers$length <- 
  sapply(strsplit(text.tweets.bukele.followers$text, " "), length)

# For presidents tweets 
text.tweets.obrador$length <- 
  sapply(strsplit(text.tweets.obrador$text, " "), length)

text.tweets.pinera$length <- 
  sapply(strsplit(text.tweets.pinera$text, " "), length)

text.tweets.lenin$length <- 
  sapply(strsplit(text.tweets.lenin$text, " "), length)

text.tweets.bukele$length <- 
  sapply(strsplit(text.tweets.bukele$text, " "), length)
```

## Data visualizations

Bind all the tweets texts into a single df
```{r}
# For followers tweets
df.tweets.visualization <- rbind(text.tweets.obrador.followers, text.tweets.pinera.followers)
df.tweets.visualization <- rbind(df.tweets.visualization, text.tweets.lenin.followers)
df.tweets.visualization <- rbind(df.tweets.visualization, text.tweets.bukele.followers )
df.tweets.visualization$line <- NULL

# For presidents tweets
df.presidents.tweets.visualization <- rbind(text.tweets.obrador, text.tweets.lenin)
df.presidents.tweets.visualization <- rbind(df.presidents.tweets.visualization, 
                                            text.tweets.pinera)
df.presidents.tweets.visualization <- rbind(df.presidents.tweets.visualization,
                                            text.tweets.bukele)
df.presidents.tweets.visualization$line <- NULL
```

Make a single histogram of the tweet lenghts 
```{r}
# For followers tweets 
hist.followers.tweet.lenghts <- ggplot(df.tweets.visualization) + 
  geom_histogram(aes(x = length, fill = doc_id) , alpha = 0.6, bins = 30)
hist.followers.tweet.lenghts

# For presidents tweets
hist.presidents.tweet.lenghts <- ggplot(df.presidents.tweets.visualization) + 
  geom_histogram(aes(x = length, fill = doc_id) , alpha = 0.6, bins = 30)
hist.presidents.tweet.lenghts
```

## Text Mining with "Udpipe" package

Define the language of the analysis
```{r}
udmodel <- udpipe_download_model(language = "spanish")
udmodel
```

Deploy the package to tokenise, and tag terms in all the tweets from presidents
followers
```{r}
udmodel.obrador.followers <- udpipe(x = text.tweets.obrador.followers$text, object = udmodel)
udmodel.pinera.followers  <- udpipe(x = text.tweets.pinera.followers$text, object = udmodel)
udmodel.lenin.followers   <- udpipe(x = text.tweets.lenin.followers$text, object = udmodel)
udmodel.bukele.followers  <- udpipe(x = text.tweets.bukele.followers$text, object = udmodel)
```


Filter the dataframes to exclude stopwords, punctuation and symbols
```{r}
udmodel.obrador.followers.filtered <- filter(udmodel.obrador.followers, 
                                            upos == "ADJ" | upos == "NOUN" |
                                            upos == "PROPN" | upos == "INTJ")

udmodel.pinera.followers.filtered <- filter(udmodel.pinera.followers, 
                                            upos == "ADJ" | upos == "NOUN" |
                                            upos == "PROPN" | upos == "INTJ")

udmodel.lenin.followers.filtered <- filter(udmodel.lenin.followers, 
                                           upos == "ADJ" | upos == "NOUN" |
                                           upos == "PROPN" | upos == "INTJ")
                                            

udmodel.bukele.followers.filtered <- filter(udmodel.bukele.followers, 
                                            upos == "ADJ" | upos== "NOUN" |
                                            upos == "PROPN" | upos == "INTJ")
                                           
```

Term Frequency
```{r}
term.frequency.obrador.followers <- txt_freq(udmodel.obrador.followers.filtered$token)
```


To check the definitions of the upos categories, check
https://universaldependencies.org/u/pos/index.html



Term Frequency


```{r}
# For presidents tweets
  word.count.obrador <- text.tweets.obrador %>% unnest_tokens(word, text)
  word.count.pinera  <- text.tweets.pinera  %>% unnest_tokens(word, text)
  word.count.lenin   <- text.tweets.lenin   %>% unnest_tokens(word, text)
  word.count.bukele  <- text.tweets.bukele  %>% unnest_tokens(word, text)
```

```{r}
# For followers tweets
  word.count.obrador.followers <- text.tweets.obrador.followers %>% 
  unnest_tokens(word, text)
  word.count.pinera.followers  <- text.tweets.pinera.followers  %>% unnest_tokens(word, text)
  word.count.lenin.followers   <- text.tweets.lenin.followers   %>% unnest_tokens(word, text)
  word.count.bukele.followers  <- text.tweets.bukele.followers  %>% unnest_tokens(word, text)
```




Lets take this approach since we avoid having to remove stopwords 
```{r}
# Get some features out of the tmls data frame
average_text_with <- mean(tmls$display_text_width)
average_retweet_count <- mean(tmls$retweet_count)

```

# Discussion 

# References 
